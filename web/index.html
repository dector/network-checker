<html>
    <head>
        <title>Network checker</title>
        <script type="text/javascript" src="jquery.js"></script>
        <style type="text/css">
            .status { width: 80px }
        </style>
        <script type="text/javascript">
            function recheckHost(statusCell, ip) {
                var status = statusCell.html();

                statusCell.html("Updating");

                $.get("checker", {h: ip}, function(data) {
                    statusCell.html(data);
                });
            }

            function updateTable() {
                var $table = $("table.data tbody");

                $.getJSON("hosts-list", {}, function(json) {
                    var tableText = "";

                    for (var i = 0; i < json.length; i++) {
                        var jsonValue = json[i];
                        tableText += '<tr><td class="status">' + jsonValue.status + '</td>';
                        tableText += '<td class="ip">' + jsonValue.ip + '</td></tr>';
                    }

                    $table.html(tableText);

                    $('td.status').click(function() {
                        var cell = $(this);

                        recheckHost(cell, $('.ip', cell.parent()).html());
                    });
                });
            };

            $(document).ready(function() {
                updateTable();

                $("input.send").click(function() {
                    var ip = $("input.host_ip").val();

                    $.get("checker", {h: ip}, function() {
                        updateTable();
                    });
                });
            });
        </script>
    </head>

    <body>
        <table class="data">
            <thead>
                <tr>
                    <td><b>Status</b></td>
                    <td><b>Host IP</b></td>
                </tr>
            </thead>
            <tbody>
            </tbody>
        </table>

        <br>

        <table class="checker">
            <tr>
                <td>IP:</td>
                <td><input type="text" maxlength="15" class="host_ip" value="127.0.0.1" /></td>
            </tr>
            <tr>
                <td></td>
                <td><input type="button" class="send" value="Check" /></td>
            </tr>
        </table>
    </body>
</html>